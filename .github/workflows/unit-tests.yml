name: run_as_root Quality Gate ðŸ¤“
on: [push]
jobs:
  login:
    name: "GitLab Login ðŸ”’"
    runs-on: ubuntu-latest
    steps:
      - name: Login to GitLab
        uses: docker/login-action@v1
        with:
          registry: registry.gitlab.com
          username: ${{ secrets.GITLAB_USERNAME }}
          password: ${{ secrets.GITLAB_PASSWORD }}
          logout: false
  unit-tests:
    name: "Unit Tests ðŸŽ‰"
    author: David Lambauer - run_as_root GmbH
    description: This GitHub Action contains a bunch of different steps to ensure the code quality is as we expect it to be.
    runs:
      using: 'docker'
      image: 'registry.gitlab.com/run_as_root/quality_as_root/pipeline/magento2-community:2.3.4-php73'
    steps:
      - name: Login to GitLab
        uses: docker/login-action@v1
        with:
          registry: registry.gitlab.com
          username: ${{ secrets.GITLAB_USERNAME }}
          password: ${{ secrets.GITLAB_PASSWORD }}
          logout: false
      - name: Composer Cache
        uses: actions/cache@v2
        with:
          path: ~/.composer
          key: v1-composer-deps-${{ hashFiles('**/composer-lock.json') }}
          restore-keys: v1-composer-deps-
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        uses: php-actions/composer@v5
      - name: Run Unit Tests
        run: docker-php-ext-enable xdebug


  codestyle:
    name: "Code Style ðŸ¤¡"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        uses: php-actions/composer@v5
      - name: Install PHP CS
        run: composer install --prefer-dist --working-dir=build/tools
      - name: Run PHP Code Style
        run: build/tools/vendor/bin/phpcs --standard=phpcs-ruleset.xml src/ --ignore-annotations